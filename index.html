<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Game: Wiki Race</title>
    <style>
        body, html { margin: 0; padding: 0; height: 100%; font-family: 'Segoe UI', sans-serif; background: #1a1a1a; color: white; overflow: hidden; }
        
        /* Start Screen */
        #start-screen {
            background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('background.jpg') no-repeat center center fixed;
            background-size: cover; height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center;
        }

        /* Top Game Bar */
        #game-header {
            display: none; background: #2c3e50; padding: 10px 20px; border-bottom: 3px solid #f1c40f;
            grid-template-columns: 1fr 2fr 1fr; align-items: center; position: sticky; top: 0; z-index: 100;
        }

        .target-box { position: relative; cursor: help; text-align: center; }
        .target-title { color: #f1c40f; font-weight: bold; font-size: 1.2rem; text-decoration: underline; }
        
        /* Hover Description */
        .tooltip {
            visibility: hidden; width: 300px; background-color: #34495e; color: #fff; text-align: left;
            border-radius: 6px; padding: 15px; position: absolute; z-index: 1; top: 125%; left: 50%;
            transform: translateX(-50%); opacity: 0; transition: opacity 0.3s; border: 1px solid #f1c40f; font-size: 0.9rem;
        }
        .target-box:hover .tooltip { visibility: visible; opacity: 1; }

        .stats-bar { display: flex; gap: 20px; font-size: 0.9rem; }
        
        /* Game Layout */
        #iframe-container { width: 100%; height: calc(100vh - 120px); background: white; }
        iframe { width: 100%; height: 100%; border: none; }

        .controls { height: 60px; background: #2c3e50; display: flex; justify-content: center; align-items: center; gap: 10px; }
        button { padding: 10px 20px; border-radius: 5px; border: none; cursor: pointer; font-weight: bold; }
        #win-btn { background: #27ae60; color: white; opacity: 0.5; cursor: not-allowed; }
        #win-btn.active { opacity: 1; cursor: pointer; box-shadow: 0 0 15px #27ae60; }

        .setup-ui { display: flex; flex-direction: column; gap: 10px; background: rgba(0,0,0,0.8); padding: 30px; border-radius: 15px; }
    </style>
</head>
<body>

    <div id="start-screen">
        <div class="setup-ui">
            <h1>BUSINESS WIKI RACE</h1>
            <button onclick="generateMatch()">CREATE NEW MATCH SEED</button>
            <input type="text" id="seed-input" placeholder="Paste Seed Here">
            <button id="start-btn" onclick="initGame()" style="background:#f1c40f;">START RACE</button>
        </div>
    </div>

    <div id="game-header">
        <div class="stats-bar">
            <span>‚è±Ô∏è <b id="timer">0s</b></span>
            <span>üñ±Ô∏è <b id="clicks">0</b></span>
            <span>üîô <b id="backs">0</b></span>
        </div>
        
        <div class="target-box">
            TARGET: <span class="target-title" id="target-display">Loading...</span>
            <div class="tooltip" id="target-desc">Hover to see description of target...</div>
        </div>

        <button onclick="location.reload()" style="background:#e74c3c; color:white;">QUIT</button>
    </div>

    <div id="iframe-container" style="display:none;">
        <iframe id="wiki-frame" src=""></iframe>
    </div>

    <div id="game-controls" class="controls" style="display:none;">
        <button id="win-btn" onclick="claimVictory()">üèÅ I AM ON THE TARGET PAGE</button>
    </div>

    <script>
        let clicks = 0;
        let backs = 0;
        let startTime;
        let targetPage = "";
        let startPage = "";

        // Pre-defined Pool for Synchronized Seeds (Business/Tech Focused)
        const articlePool = [
            {title: "Apple Inc.", desc: "A multinational tech company known for iPhones and Macs."},
            {title: "Steve Jobs", desc: "Co-founder of Apple and pioneer of the microcomputer revolution."},
            {title: "Stock market", desc: "The aggregation of buyers and sellers of stocks."},
            {title: "Elon Musk", desc: "CEO of Tesla and SpaceX."},
            {title: "Bitcoin", desc: "The first decentralized cryptocurrency."},
            {title: "Silicon Valley", desc: "A global center for high technology and innovation in California."},
            {title: "Fortune 500", desc: "An annual list of the 500 largest US corporations."}
        ];

        function generateMatch() {
            const seed = Math.floor(Math.random() * 10000);
            const url = window.location.href.split('?')[0] + "?seed=" + seed;
            navigator.clipboard.writeText(url);
            alert("Match Seed Generated & URL Copied! Send this to your friend.");
            location.href = url;
        }

        function initGame() {
            const urlParams = new URLSearchParams(window.location.search);
            const seed = parseInt(urlParams.get('seed')) || 1234;
            
            // Use Seed to pick pages (Always the same for the same seed)
            const startIdx = seed % articlePool.length;
            const targetIdx = (seed + 3) % articlePool.length;

            startPage = articlePool[startIdx].title;
            targetPage = articlePool[targetIdx].title;

            document.getElementById('target-display').innerText = targetPage;
            document.getElementById('target-desc').innerText = articlePool[targetIdx].desc;

            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('game-header').style.display = 'grid';
            document.getElementById('iframe-container').style.display = 'block';
            document.getElementById('game-controls').style.display = 'flex';

            const frame = document.getElementById('wiki-frame');
            frame.src = `https://en.m.wikipedia.org/wiki/${startPage.replace(/ /g, '_')}`;
            
            startTime = Date.now();
            startTracking();
        }

        function startTracking() {
            const frame = document.getElementById('wiki-frame');
            
            setInterval(() => {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                document.getElementById('timer').innerText = elapsed + "s";
                
                // Security Check: Enable win button only if URL contains target title
                try {
                    const currentUrl = frame.contentWindow.location.href;
                    if (currentUrl.includes(targetPage.replace(/ /g, '_'))) {
                        document.getElementById('win-btn').classList.add('active');
                    } else {
                        document.getElementById('win-btn').classList.remove('active');
                    }
                } catch(e) { 
                    // Cross-origin prevents reading exact URL, so we rely on user clicking "Win" 
                    // and checking the frame title if possible, or just allowing click.
                    document.getElementById('win-btn').classList.add('active');
                }
            }, 1000);

            // Click Counter Listener
            frame.onload = function() {
                clicks++;
                document.getElementById('clicks').innerText = clicks;
            };
        }

        function claimVictory() {
            if(!document.getElementById('win-btn').classList.contains('active')) {
                alert("You aren't on the target page yet!");
                return;
            }
            const timeTaken = document.getElementById('timer').innerText;
            alert(`üèÜ MISSION COMPLETE!\n\nTime: ${timeTaken}\nTotal Clicks: ${clicks}\nBack-button Uses: ${backs}`);
            location.reload();
        }

        // Detect Back Button usage
        window.addEventListener('popstate', function() {
            backs++;
            document.getElementById('backs').innerText = backs;
        });

        // Check for seed on load
        window.onload = () => {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('seed')) {
                document.getElementById('seed-input').value = urlParams.get('seed');
            }
        };
    </script>
</body>
</html>
